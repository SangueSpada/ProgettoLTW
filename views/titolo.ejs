<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="..\bootstrap-5.1.3\dist\css\bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <script type="application/javascript" src="..\bootstrap-5.1.3\dist\js\bootstrap.bundle.min.js"></script>


    <title>Offerta cercata</title>
    <style>
        body {
            background: linear-gradient(to bottom, rgb(152, 147, 147), transparent), url('../yellow-floral-bushes-overlook-the-city.jpg');
            background-size: cover, cover;
            background-repeat: no-repeat;
        }
    </style>
</head>

<body>
    <%- include('navbar')%>
        <div style="padding: 40pt;"></div>

        <div class="container">


            <div class="row">
                <div class="col-md-8">

                    <image class="img-fluid" width="100%" src="<%=offerta.immagine%>"> </image>


                </div>

                <div class="col-md-4">
                    <div style="padding: 15pt;"></div>

                    <div class="row">
                        <div class="col-md-6">
                            <h3 class="lead"> nome&#160hotel:
                            </h3>
                        </div>
                        <div class="col-md-6 ">
                            <h4 class="mb-0">
                                <%=offerta.titolo%>
                            </h4>
                        </div>
                    </div>

                    <hr>

                    <div class="row">
                        <div class="col-md-6">
                            <h3 class="lead"> indirizzo:
                            </h3>
                        </div>
                        <div class="col-md-6 ">
                            <h4 class="mb-0">
                                <%=offerta.indirizzo%>
                            </h4>
                        </div>
                    </div>
                    <hr>


                    <div class="row">
                        <div class="col-md-6">
                            <h3 class="lead"> città:
                            </h3>
                        </div>
                        <div class="col-md-6 ">
                            <h4 class="mb-0">
                                <%=offerta.citta%>
                            </h4>
                        </div>
                    </div>
                    <hr>
                    <div class="row">

                        <div class="col-md-6">
                            <h3 class="lead">prezzo&#160per&#160notte:</h3>


                        </div>
                        <div class="col-md-6">
                            <h4 class="mb-0">
                                <%=offerta.prezzo%>
                            </h4>
                        </div>
                    </div>

                    <hr>
                    <div class="row">

                        <div class="col-md-6">
                            <h3 class="lead">posti&#160letto:</h3>


                        </div>
                        <div class="col-md-6">
                            <h4 class="mb-0">
                                <%=offerta.disponibilita%>
                            </h4>
                        </div>
                    </div>

                    <hr>

                    <div class="row">
                        <div class="col-md-6">
                            <h3 class="lead"> descrizione:
                            </h3>
                        </div>
                        <div class="col-md-6 ">
                            <h4 class="mb-0">
                                <%=offerta.descrizione%>
                            </h4>
                        </div>
                    </div>

                    <hr>






                </div>
            </div>

            <div class="row">
                <div class="col-lg-12 text-center">
                    <div style="padding: 40pt;"></div>
                    <nav class="shadow container p-3 rounded-3" style="background-color: #e3f2fd;">
                        <form method="post" action="/prenota">
                            <div class="row">
                                <input type="text" id="testo_ricerca" name="testo_ricerca" value="<%=offerta.titolo%>" hidden>
                                <div class="col-md-3 mt-2">
                                    <label class="active" for="dateStandard">Check-in:</label>
                                    <input type="date" id="CheckInDate" name="CheckIn" onchange="checkin_fun();" value="<%= search[1] || '' %>" required>
                                </div>
                                <div class="col-md-3 mt-2">
                                    <label class="active" for="dateStandard">Check-out:</label>
                                    <input type="date" id="CheckOutDate" name="CheckOut" onchange="checkout_fun();" value="<%=search[2] || ''%>" required>
                                </div>
                                <div class="col-md-3 mt-2">
                                    <label class="active">Partecipanti:</label>
                                    <div class="btn-group">
                                        <button type="button" id="lessBtn" class="btn btn-light rounded-circle" onclick="lessBtnRange()">-</button>
                                        <input type="number" value="1" name="partecipants" id="partecipants" class="form-control-plaintext text-center" readonly style="width: 25pt;">
                                        <button type="button" id="moreBtn" class="btn btn-light rounded-circle" onclick="moreBtnRange()">+</button>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <label class="active">Prezzo calcolato:</label>
                                    <input type="text" value="0 €" style="text-align:center;" readonly="readonly" id="prezzo_finale" name="prezzo_finale" class="form-control" aria-label="Recipient's username" required>
                                </div>
                            </div>
                            <div class="row">
                                <div class="mt-2">
                                    <div id="PrenotaDiv">
                                        <span class="d-inline-block" id="popover" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus" data-bs-content="Per poter proseguire con la prenotazione è necessario essere loggati">
                                        <button class="btn rounded-3 fw-bold" id="prenota" style="background-color: #68d7f3;"  onclick="conf_fun()" disabled>Prenota ora!!!</button>
                                        </span>
                                    </div>
                                    <div id="ConfDiv" hidden>
                                        <label style="color: red;">Sei Sicuro di voler effettuare la prenotazione?</label>
                                        <button type="button" id="btnConfirm" class="btn btn-secondary" onclick="reset_fun()">Annulla</button>
                                        <button type="submit" class="btn rounded-3 fw-bold" style="background-color: #68d7f3;">Conferma</button>
                                    </div>
                                </div>
                            </div>

                        </form>
                    </nav>
                    <div id="invalid-dates" style="color:red;" hidden>
                        Le date inserite non sono disponibili, per favore cambia data o verifica che l hotel abbia effettivamente tali posti liberi
                    </div>
                    <div style="padding: 20pt;"></div>
                </div>
            </div>
        </div>


        <%- include('../footer.html'); -%>
</body>
<script>
    var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
    var popoverList = popoverTriggerList.map(function(popoverTriggerEl) {
        return new bootstrap.Popover(popoverTriggerEl)
    })
    var search = '<%=search%>';
    if (search != '') {
        var invalid_date = document.getElementById("invalid-dates");
        invalid_date.hidden = false;
    }

    function checkin_fun() {
        if (search != '') {
            var invalid_date = document.getElementById("invalid-dates");
            invalid_date.hidden = true;
        }

        var checkin = document.getElementById("CheckInDate");
        var checkout = document.getElementById("CheckOutDate");
        var in_date = new Date(checkin.value);
        var out_date = in_date;
        var today = new Date();
        if (in_date <= today) {
            alert("data non valida!");
            checkin.value = new Date();
        }
        out_date.setDate(out_date.getDate() + 1);
        checkout.value = out_date.toISOString().split('T')[0];
        calcolo_prezzo();
    }

    function checkout_fun() {

        var checkin = document.getElementById("CheckInDate");
        var checkout = document.getElementById("CheckOutDate");
        var in_date;
        var out_date = new Date(checkout.value);
        if (checkin.value == '') {
            alert("Scegli prima la data di partenza");
            checkout.value = new Date();
            return
        } else {
            in_date = new Date(checkin.value);
            if (in_date >= out_date) {
                alert("data non valida!");
                checkout.value = new Date();
            } else {
                calcolo_prezzo();
            }
        }
    }

    function calcolo_prezzo() {

        var checkin = document.getElementById("CheckInDate");
        var checkout = document.getElementById("CheckOutDate");
        var part = document.getElementById("partecipants");
        var prenota = document.getElementById("prezzo_finale");
        var giorni = dateDiffInDays(new Date(checkin.value), new Date(checkout.value));
        var prezzo = giorni * part.valueAsNumber * Number("<%=offerta.prezzo%>");
        prenota.value = prezzo + ' €';

    }

    function dateDiffInDays(a, b) {

        var _MS_PER_DAY = 1000 * 60 * 60 * 24;

        // Esclude l'ora ed il fuso orario
        var utc1 = Date.UTC(a.getFullYear(), a.getMonth(), a.getDate());
        var utc2 = Date.UTC(b.getFullYear(), b.getMonth(), b.getDate());

        return Math.floor((utc2 - utc1) / _MS_PER_DAY);
    }



    function lessBtnRange() {
        var lessBtn = document.getElementById("lessBtn");
        var moreBtn = document.getElementById("moreBtn");
        var part = document.getElementById("partecipants");
        var checkin = document.getElementById("CheckInDate");
        var checkout = document.getElementById("CheckOutDate");

        if (part.valueAsNumber == 1) {
            lessBtn.disabled = true;
        } else {
            lessBtn.disabled = false;
            moreBtn.disabled = false;
            part.value = part.valueAsNumber - 1;
        }
        if (checkin.valueAsNumber >= 0 && checkout.valueAsNumber >= 0) {
            calcolo_prezzo();
        }
    }

    function moreBtnRange() {
        var lessBtn = document.getElementById("lessBtn");
        var moreBtn = document.getElementById("moreBtn");
        var part = document.getElementById("partecipants");
        var checkin = document.getElementById("CheckInDate");
        var checkout = document.getElementById("CheckOutDate");

        if (part.valueAsNumber == 10) {
            moreBtn.disabled = true;
        } else {
            moreBtn.disabled = false;
            lessBtn.disabled = false;
            part.value = part.valueAsNumber + 1;
        }
        if (checkin.valueAsNumber >= 0 && checkout.valueAsNumber >= 0) {
            calcolo_prezzo();
        }
    }

    function conf_fun() {
        var prenotaDiv = document.getElementById("PrenotaDiv");
        var confDiv = document.getElementById("ConfDiv");
        prenotaDiv.hidden = true;
        confDiv.hidden = false;
    }

    function reset_fun(ts) {
        var prenotaDiv = document.getElementById("PrenotaDiv");
        var confDiv = document.getElementById("ConfDiv");
        prenotaDiv.hidden = false;
        confDiv.hidden = true;
    }

    (function() {
        var cookies = "<%=profilo%>";
        if (cookies == "") {
            var button = document.getElementById('prenota');
            var popover = document.getElementById('popover');
            var Bpopover = new bootstrap.Popover(popover, {})
            Bpopover.enable();
            button.disabled = true;

        } else {
            var button = document.getElementById('prenota');
            var popover = document.getElementById('popover');
            var Bpopover = new bootstrap.Popover(popover, {})
            Bpopover.disable();
            button.disabled = false;

        }

    })();

    //effetto scroll rallentato
    $(function() {

        $('a[href*="#"]:not([href="#"])').click(function() {

            if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') && location.hostname == this.hostname) {

                var target = $(this.hash);
                target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
                if (target.length) {

                    $('html,body').animate({

                        scrollTop: target.offset().top
                    }, 500);
                    return false;

                }


            }



        });




    });
</script>

</html>